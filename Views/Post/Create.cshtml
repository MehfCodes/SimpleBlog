@model SimpleBlog.Models.ViewModel.PostCreateViewModel;

@{
    ViewData["Title"] = "Create Post";
    @* var tags = ViewBag.Tags as List<SimpleBlog.Models.Domain.Tag>;
    var selectTags = Array.Empty<string>(); *@
}

<div class="container">
    <h2>Create Post</h2>

    <form asp-action="Create" method="post">
        <div class="form-group mb-3">
            <label asp-for="Title" class="form-label"></label>
            <input asp-for="Title" class="form-control" />
            <span asp-validation-for="Title" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label class="form-label fw-bold" for="Content">Content</label>
            <textarea class="form-control" id="Content" asp-for="Content"></textarea>
            <span asp-validation-for="Content" class="text-danger"></span>
        </div>
        <div class="mb-4">
                <label class="form-label fw-bold" for="FeaturedImageUpload"> Featured Image Upload </label>
                <input type="file" class="form-control" id="FeaturedImageUpload">
                <img src="" style="display:none;width:300px" class="mt-3 mx-auto" id="FeaturedImageDisplay" />
        </div>
        <div class="mb-4">
                <label class="form-label fw-bold" for="FeaturedImageUrl"> Featured Image Url </label>
                <input type="text" class="form-control" id="FeaturedImageUrl" asp-for="FeaturedImageUrl">
        </div>
        <div class="mb-3">
            <label asp-for="SelectedTagIds" class="form-label">Tags</label>
            <select asp-for="SelectedTagIds" asp-items="Model.AllTags" class="form-select" multiple>
                <option value="">-- Select a Tag --</option>
            </select>
        </div>


        <button type="submit" class="btn btn-primary">Add</button>
        <a asp-action="UserPostsIndex" class="btn btn-secondary">Cancel</a>
    </form>

</div>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
   <script>
        let editor = new FroalaEditor("#Content",{
            imageUploadURL: '/api/image'
        });
        let featuredImageUploadElement = document.getElementById("FeaturedImageUpload");
        let featuredImageUrlElement = document.getElementById("FeaturedImageUrl");
        let featuredImageDisplayElement = document.getElementById("FeaturedImageDisplay");
        async function uploadImage(e){
            let data = new FormData();
            data.append('file', e.target.files[0])
            let res = await fetch('/api/image',{
            method:"POST",
            headers:{
                "Aceept":"*/*",
            },
            body: data
        })
        let result = await res.json();
        featuredImageUrlElement.value = result.link;
        featuredImageDisplayElement.src = result.link;
        featuredImageDisplayElement.style.display='block';
        }
        featuredImageUploadElement.addEventListener("change",uploadImage)
   </script>
}
